
// 2. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –ø–æ–ø—É–ª—è—Ü—ñ—ó**

//–ì–µ–Ω–µ—Ä—É—î–º–æ **POP_SIZE (100)** –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —Ä—ñ—à–µ–Ω—å.
///–ö–æ–∂–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è ‚Äî —Ü–µ **—Ä–æ–∑–ø–æ–¥—ñ–ª –∫–≤–∞—Ä—Ç–∏—Ä –º—ñ–∂ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç–∞–º–∏**, —Ç–æ–±—Ç–æ –∫–æ–º—É —è–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –¥—ñ—Å—Ç–∞–Ω–µ—Ç—å—Å—è.
//–ù–∞ —Ü—å–æ–º—É –µ—Ç–∞–ø—ñ –∫–≤–∞—Ä—Ç–∏—Ä–∏ –æ–±–∏—Ä–∞—é—Ç—å—Å—è **–≤–∏–ø–∞–¥–∫–æ–≤–æ**, –∞–ª–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä—ñ–≤.


//3. **–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ñ—ñ—Ç–Ω–µ—Å—É**

// –î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è –æ–±—á–∏—Å–ª—é—î–º–æ **–∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç–∞ —Å–≤–æ—î—é –∫–≤–∞—Ä—Ç–∏—Ä–æ—é**:
    /// **–¶—ñ–Ω–∞** ‚Äî –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –∑–∞ –±—é–¥–∂–µ—Ç–æ–º.
    // **–ü–ª–æ—â–∞** ‚Äî —á–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–µ–ª–∏–∫–∞.
    //**–í—ñ–¥—Å—Ç–∞–Ω—å** ‚Äî —á–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –Ω–µ –Ω–∞–¥—Ç–æ –¥–∞–ª–µ–∫–æ.
    // **–ö–æ–º—Ñ–æ—Ä—Ç** ‚Äî –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞.
// –í—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è **–≤–∞–≥–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤**: 30% —Ü—ñ–Ω–∞, 20% –ø–ª–æ—â–∞, 20% –≤—ñ–¥—Å—Ç–∞–Ω—å, 30% –∫–æ–º—Ñ–æ—Ä—Ç.
// –§—ñ—Ç–Ω–µ—Å —Ä—ñ—à–µ–Ω–Ω—è = **—Å–µ—Ä–µ–¥–Ω—è –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å –≤—Å—ñ—Ö –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç—ñ–≤**.



//4. **–ï–≤–æ–ª—é—Ü—ñ—è –ø–æ–∫–æ–ª—ñ–Ω—å**
//–¶–µ –≥–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –∞–ª–≥–æ—Ä–∏—Ç–º—É:

//a) **–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è**
//–í—Å—ñ —Ä—ñ—à–µ–Ω–Ω—è —Å–æ—Ä—Ç—É—é—Ç—å—Å—è –∑–∞ —Ñ—ñ—Ç–Ω–µ—Å–æ–º –≤—ñ–¥ –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ –¥–æ –Ω–∞–π–≥—ñ—Ä—à–æ–≥–æ.

// b) **–ï–ª—ñ—Ç–∞**
//ELITE (5)** 5 –Ω–∞–π–∫—Ä–∞—â–∏—Ö —Ä—ñ—à–µ–Ω—å –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω, —â–æ–± –Ω–µ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ —Ö–æ—Ä–æ—à—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏.

// c) **–í–∏–±—ñ—Ä –±–∞—Ç—å–∫—ñ–≤**
// –î–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ä—ñ—à–µ–Ω—å –æ–±–∏—Ä–∞—î–º–æ –±–∞—Ç—å–∫—ñ–≤ –º–µ—Ç–æ–¥–æ–º **—Ç—É—Ä–Ω—ñ—Ä—É**:
   // –í–∏–ø–∞–¥–∫–æ–≤–æ –±–µ—Ä–µ–º–æ –¥–≤—ñ —Ä—ñ—à–µ–Ω–Ω—è.
   // –í–∏–±–∏—Ä–∞—î–º–æ –∫—Ä–∞—â–µ –∑ –Ω–∏—Ö.



// d) **–ö—Ä–æ—Å–æ–≤–µ—Ä**


//–ó –¥–≤–æ—Ö –±–∞—Ç—å–∫—ñ–≤ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è **–¥–∏—Ç–∏–Ω–∞**:
   // –í–∏–±–∏—Ä–∞—î—Ç—å—Å—è **–æ–¥–Ω–∞ —Ç–æ—á–∫–∞**.
    //–ë–µ—Ä–µ–º–æ –≤—Å—ñ –∫–≤–∞—Ä—Ç–∏—Ä–∏ –¥–æ —Ü—ñ—î—ó —Ç–æ—á–∫–∏ –≤—ñ–¥ –ø–µ—Ä—à–æ–≥–æ –±–∞—Ç—å–∫–∞.
    // –î–æ–¥–∞—î–º–æ —Ä–µ—à—Ç—É –∫–≤–∞—Ä—Ç–∏—Ä –≤—ñ–¥ –¥—Ä—É–≥–æ–≥–æ –±–∞—Ç—å–∫–∞, –∞–ª–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä—ñ–≤.
// –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ **–∫–æ–∂–µ–Ω –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç –æ—Ç—Ä–∏–º–∞—î –æ–¥–Ω—É –∫–≤–∞—Ä—Ç–∏—Ä—É**.

// e) **–ú—É—Ç–∞—Ü—ñ—è**

//–Ü–Ω–æ–¥—ñ (–∑ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é MUTATION_RATE = 0.2) –º—ñ–Ω—è—î–º–æ –º—ñ—Å—Ü—è–º–∏ –¥–≤—ñ –∫–≤–∞—Ä—Ç–∏—Ä–∏ —É —Ä—ñ—à–µ–Ω–Ω—ñ, —â–æ–± –¥–æ–¥–∞—Ç–∏ **—Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç—Ç—è** —ñ –Ω–µ –∑–∞—Å—Ç—Ä—è–≥—Ç–∏ —É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –º–∞–∫—Å–∏–º—É–º—ñ.

// f) **–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è**

//–ö—Ä–æ–∫–∏ b‚Äìe –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è, –ø–æ–∫–∏ –Ω–µ –±—É–¥–µ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∞ **–Ω–æ–≤–∞ –ø–æ–ø—É–ª—è—Ü—ñ—è —Ç–æ–≥–æ –∂ —Ä–æ–∑–º—ñ—Ä—É**.
//–¢–∞–∫ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **GENERATIONS (200) —Ä–∞–∑—ñ–≤**, –µ–≤–æ–ª—é—Ü—ñ–æ–Ω—É—é—á–∏ —Ä—ñ—à–µ–Ω–Ω—è –≤—ñ–¥ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –¥–æ –∫—Ä–∞—â–∏—Ö.


// 5. **–í–∏–±—ñ—Ä –Ω–∞–π–∫—Ä–∞—â–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è**

//–ü—ñ—Å–ª—è –≤—Å—ñ—Ö –ø–æ–∫–æ–ª—ñ–Ω—å —Å–æ—Ä—Ç—É—î–º–æ –ø–æ–ø—É–ª—è—Ü—ñ—é —ñ –±–µ—Ä–µ–º–æ **–Ω–∞–π–∫—Ä–∞—â–µ —Ä—ñ—à–µ–Ω–Ω—è** –∑–∞ —Ñ—ñ—Ç–Ω–µ—Å–æ–º.
// –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –π–æ–≥–æ —É —Ç–∞–±–ª–∏—Ü—ñ, –¥–µ **–∑–µ–ª–µ–Ω–∏–π** ‚Äî –¥—É–∂–µ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–∏–π –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç, **–∂–æ–≤—Ç–∏–π** ‚Äî —Å–µ—Ä–µ–¥–Ω—ñ–π, **—á–µ—Ä–≤–æ–Ω–∏–π** ‚Äî –Ω–∏–∑—å–∫–∏–π —Ä—ñ–≤–µ–Ω—å –∑–∞–¥–æ–≤–æ–ª–µ–Ω–æ—Å—Ç—ñ.


//–†–æ–∑–º—ñ—Ä –ø–æ–ø—É–ª—è—Ü—ñ—ó = POP_SIZE (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 100).
//–ï–ª—ñ—Ç–∞ = ELITE (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 5) ‚Äì –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –±–µ–∑ —Ç—É—Ä–Ω—ñ—Ä—É.
//–î–ª—è —Ä–µ—à—Ç–∏ 95 –¥—ñ—Ç–µ–π –∫–æ–∂–µ–Ω –±–∞—Ç—å–∫–æ –æ–±–∏—Ä–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ç—É—Ä–Ω—ñ—Ä.
//–ö–æ–∂–Ω–∞ –¥–∏—Ç–∏–Ω–∞ –≤ —Ç–≤–æ—î–º—É –∫–æ–¥—ñ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –¥–≤–æ–º–∞ –±–∞—Ç—å–∫–∞–º–∏, —Ç–æ–±—Ç–æ –¥–ª—è –∫–æ–∂–Ω–æ—ó –¥–∏—Ç–∏–Ω–∏ –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –¥–≤–∞ —Ç—É—Ä–Ω—ñ—Ä–∏ (–ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–∞—Ç—å–∫–∞).


// ======== –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ ========
let apartments = [];  // –¢—É—Ç –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º—É—Ç—å—Å—è –¥–∞–Ω—ñ –ø—Ä–æ –∫–≤–∞—Ä—Ç–∏—Ä–∏ (–ø—ñ—Å–ª—è –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –∑ —Ñ–∞–π–ª—É)
let tenants = [];     // –¢—É—Ç –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º—É—Ç—å—Å—è –¥–∞–Ω—ñ –ø—Ä–æ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç—ñ–≤ (–ø—ñ—Å–ª—è –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –∑ —Ñ–∞–π–ª—É)

// ======== –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥–µ–Ω–µ—Ç–∏—á–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É ========
const POP_SIZE = 100;        // –°–∫—ñ–ª—å–∫–∏ —Ä—ñ–∑–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ (—Ä—ñ—à–µ–Ω—å) —É –∫–æ–∂–Ω–æ–º—É –ø–æ–∫–æ–ª—ñ–Ω–Ω—ñ
const GENERATIONS = 200;     // –°–∫—ñ–ª—å–∫–∏ —Ä–∞–∑—ñ–≤ "–µ–≤–æ–ª—é—Ü—ñ—è" –ø–æ–≤—Ç–æ—Ä–∏—Ç—å—Å—è
const CROSSOVER_RATE = 0.8;  // –ô–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å —Å—Ö—Ä–µ—â—É–≤–∞–Ω–Ω—è –¥–≤–æ—Ö —Ä—ñ—à–µ–Ω—å
const MUTATION_RATE = 0.2;   // –ô–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó –º—É—Ç–∞—Ü—ñ—ó
const ELITE = 5;             // –ö—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞–π–∫—Ä–∞—â–∏—Ö —Ä—ñ—à–µ–Ω—å, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω

// ======== –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è CSV-—Ñ–∞–π–ª—É ========
function parseCSV(content) {
  const lines = content.trim().split("\n"); // –†–æ–∑–±–∏–≤–∞—î–º–æ —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—è–¥–∫–∏
  // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–µ—Ä—à–∏–π —Ä—è–¥–æ–∫ (–∑–∞–≥–æ–ª–æ–≤–∫–∏) —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ —á–∏—Å–ª–∞
  return lines.slice(1).map(line => line.split(",").map(Number));
}

// ======== –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —ñ–∑ —Ñ–∞–π–ª—ñ–≤ ========

// –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±–∏—Ä–∞—î —Ñ–∞–π–ª –∑ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏
document.getElementById("apartmentsFile").addEventListener("change", (e) => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(evt){
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –ø—Ä–æ –∫–≤–∞—Ä—Ç–∏—Ä–∏
    apartments = parseCSV(evt.target.result).map(row => ({
      area: row[0], price: row[1], distance: row[2], comfort: row[3]
    }));
  }
  reader.readAsText(file);
});

// –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±–∏—Ä–∞—î —Ñ–∞–π–ª –∑ –ø–æ–±–∞–∂–∞–Ω–Ω—è–º–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç—ñ–≤
document.getElementById("tenantsFile").addEventListener("change", (e) => {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(evt){
    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ–±–∞–∂–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç–∞
    tenants = parseCSV(evt.target.result).map(row => ({
      maxPrice: row[0], minArea: row[1], maxDistance: row[2], minComfort: row[3]
    }));
  }
  reader.readAsText(file);
});


// ======== –§—ñ—Ç–Ω–µ—Å-—Ñ—É–Ω–∫—Ü—ñ—è (–æ—Ü—ñ–Ω–∫–∞ —è–∫–æ—Å—Ç—ñ —Ä—ñ—à–µ–Ω–Ω—è) ========
function fitness(solution) {
  let totalSat = 0; // –ó–∞–≥–∞–ª—å–Ω–∞ –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å —É—Å—ñ—Ö –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç—ñ–≤

  // –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä–∞
  solution.forEach((aptIdx, tenantIdx) => {
    const t = tenants[tenantIdx]; // –ø–æ—Ç–æ—á–Ω–∏–π –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç
    const a = apartments[aptIdx]; // –≤–∏–±—Ä–∞–Ω–∞ –π–æ–º—É –∫–≤–∞—Ä—Ç–∏—Ä–∞

    // –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–∞–¥–æ–≤–æ–ª–µ–Ω–æ—Å—Ç—ñ –ø–æ –∫–æ–∂–Ω–æ–º—É –∫—Ä–∏—Ç–µ—Ä—ñ—é (0 ‚Äî –ø–æ–≥–∞–Ω–æ, 1 ‚Äî —ñ–¥–µ–∞–ª—å–Ω–æ)
    const s_price = Math.max(0, Math.min(1, 1 - Math.abs(a.price - t.maxPrice)/t.maxPrice));
    const s_area  = Math.max(0, Math.min(1, a.area / t.minArea));
    const s_dist  = Math.max(0, Math.min(1, 1 - a.distance / t.maxDistance));
    const s_comf  = Math.max(0, Math.min(1, a.comfort / t.minComfort));

    // –ü—ñ–¥—Ä–∞—Ö–æ–≤—É—î–º–æ —Å–µ—Ä–µ–¥–Ω—é –æ—Ü—ñ–Ω–∫—É –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –≤–∞–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
    totalSat += 0.3*s_price + 0.2*s_area + 0.2*s_dist + 0.3*s_comf;
  });

  // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Å–µ—Ä–µ–¥–Ω—é –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å (—á–∏–º –±–ª–∏–∂—á–µ –¥–æ 1, —Ç–∏–º –∫—Ä–∞—â–µ)
  return totalSat / tenants.length;
}


// ======== –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ —Ä—ñ—à–µ–Ω–Ω—è ========
function createIndividual() {
  let indices = Array.from({length: apartments.length}, (_, i) => i); // –Ω–æ–º–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä
  let shuffled = [];
  for(let i=0; i<tenants.length; i++){
    // –í–∏–ø–∞–¥–∫–æ–≤–æ –≤–∏–±–∏—Ä–∞—î–º–æ –∫–≤–∞—Ä—Ç–∏—Ä—É, —è–∫—É —â–µ –Ω—ñ—Ö—Ç–æ –Ω–µ –∑–∞–π–Ω—è–≤
    let idx = Math.floor(Math.random() * indices.length);
    shuffled.push(indices[idx]);
    indices.splice(idx,1); // –í–∏–¥–∞–ª—è—î–º–æ, —â–æ–± –Ω–µ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–ª–∞—Å—è
  }
  return shuffled; // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç —Ä–æ–∑–ø–æ–¥—ñ–ª—É
}


// ======== –í–∏–±—ñ—Ä –∫—Ä–∞—â–∏—Ö —Ä—ñ—à–µ–Ω—å (—Ç—É—Ä–Ω—ñ—Ä) ========
function tournamentSelection(pop) {
  const a = pop[Math.floor(Math.random()*pop.length)];
  const b = pop[Math.floor(Math.random()*pop.length)];
  // –ë–µ—Ä–µ–º–æ —Ç–µ, —É —è–∫–æ–≥–æ —Ñ—ñ—Ç–Ω–µ—Å –∫—Ä–∞—â–∏–π
  return fitness(a) > fitness(b) ? a : b;
}


// ======== –ö—Ä–æ—Å–æ–≤–µ—Ä (—Å—Ö—Ä–µ—â—É–≤–∞–Ω–Ω—è –¥–≤–æ—Ö —Ä—ñ—à–µ–Ω—å) ========
//–ö—Ä–æ—Å–æ–≤–µ—Ä ‚Äî —Ü–µ —è–∫ ‚Äú—Å—Ö—Ä–µ—â—É–≤–∞–Ω–Ω—è‚Äù –¥–≤–æ—Ö —Ä—ñ—à–µ–Ω—å, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ, –∫—Ä–∞—â–µ. –£ –Ω–∞—à—ñ–π –ø—Ä–æ–≥—Ä–∞–º—ñ 
// –∫–æ–∂–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –ø–æ–∫–∞–∑—É—î, —è–∫—É –∫–≤–∞—Ä—Ç–∏—Ä—É –æ—Ç—Ä–∏–º—É—î –∫–æ–∂–µ–Ω –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç. –ü—ñ–¥ —á–∞—Å –∫—Ä–æ—Å–æ–≤–µ—Ä—É —á–∞—Å—Ç–∏–Ω—É –ø–∞—Ä
//  ‚Äú–∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç‚Äì–∫–≤–∞—Ä—Ç–∏—Ä–∞‚Äù –∞–ª–≥–æ—Ä–∏—Ç–º –±–µ—Ä–µ –≤—ñ–¥ –æ–¥–Ω–æ–≥–æ –±–∞—Ç—å–∫–∞, –∞ —Ä–µ—à—Ç—É ‚Äî –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ. –¢–∞–∫ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π 
// –≤–∞—Ä—ñ–∞–Ω—Ç —Ä–æ–∑–ø–æ–¥—ñ–ª—É, —è–∫–∏–π –ø–æ—î–¥–Ω—É—î —Ö–æ—Ä–æ—à—ñ —á–∞—Å—Ç–∏–Ω–∏ –≤—ñ–¥ –æ–±–æ—Ö. –ü–æ—Ç—ñ–º —Ü–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è ‚Äî —è–∫—â–æ –≤—ñ–Ω –¥–∞—î
//  –±—ñ–ª—å—à—É –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å, –π–æ–≥–æ –∑–∞–ª–∏—à–∞—é—Ç—å –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è.

function crossover(p1, p2) {
  // –Ü–Ω–æ–¥—ñ —Å—Ö—Ä–µ—â—É–≤–∞–Ω–Ω—è –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é—î–º–æ –ø–µ—Ä—à–æ–≥–æ
  if(Math.random() > CROSSOVER_RATE) return [...p1];

  // –í–∏–ø–∞–¥–∫–æ–≤–∞ —Ç–æ—á–∫–∞ —Ä–æ–∑–¥—ñ–ª—É
  const point = Math.floor(Math.random() * p1.length) + 1;

  // –ë–µ—Ä–µ–º–æ –ø–µ—Ä—à—É —á–∞—Å—Ç–∏–Ω—É –≤—ñ–¥ p1
  let child = p1.slice(0, point);

  // –î–æ–¥–∞—î–º–æ —Ä–µ—à—Ç—É –∫–≤–∞—Ä—Ç–∏—Ä –∑ p2 (—è–∫–∏—Ö —â–µ –Ω–µ–º–∞)
  p2.forEach(g => {
    if(!child.includes(g) && child.length < tenants.length) child.push(g);
  });

  // –Ø–∫—â–æ –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î –∫–≤–∞—Ä—Ç–∏—Ä ‚Äî –¥–æ–¥–∞—î–º–æ –±—É–¥—å-—è–∫—ñ –≤—ñ–ª—å–Ω—ñ
  while(child.length < tenants.length) {
    for(let g of p1) {
      if(!child.includes(g)) { child.push(g); if(child.length===tenants.length) break; }
    }
  }
  return child;
}




// ======== –ú—É—Ç–∞—Ü—ñ—è (–≤–∏–ø–∞–¥–∫–æ–≤—ñ –∑–º—ñ–Ω–∏) 
// –ú—É—Ç–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∫–æ–≤–æ –æ–±–∏—Ä–∞—î –¥–≤–∞ –º—ñ—Å—Ü—è —ñ –º—ñ–Ω—è—î —ó—Ö –º—ñ—Å—Ü—è–º–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:

//[2, 0, 1, 3] ‚Üí [2, 1, 0, 3]

//–¢–µ–ø–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç–∏ ‚Ññ2 —ñ ‚Ññ3 –ø–æ–º—ñ–Ω—è–ª–∏—Å—å –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏.

//üîπ –î–ª—è —á–æ–≥–æ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ:

//‚úÖ –©–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ ‚Äú–∑–∞—Å—Ç—Ä—è–≥–∞–Ω–Ω—è‚Äù –∞–ª–≥–æ—Ä–∏—Ç–º—É, –∫–æ–ª–∏ –≤—Å—ñ —Ä—ñ—à–µ–Ω–Ω—è —Å—Ç–∞–ª–∏ –æ–¥–Ω–∞–∫–æ–≤–∏–º–∏.
//‚úÖ –©–æ–± –∑–Ω–∞–π—Ç–∏ –Ω–æ–≤—ñ, –º–æ–∂–ª–∏–≤–æ –∫—Ä–∞—â—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª—É.
//‚úÖ –©–æ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω—ñ—Å—Ç—å —É –ø–æ–ø—É–ª—è—Ü—ñ—ó.

function mutate(ind) {
  // –Ü–Ω–æ–¥—ñ –¥–≤–∞ –µ–ª–µ–º–µ–Ω—Ç–∏ –º—ñ–Ω—è—é—Ç—å—Å—è –º—ñ—Å—Ü—è–º–∏
  if(Math.random() < MUTATION_RATE){
    const [i,j] = [Math.floor(Math.random()*ind.length), Math.floor(Math.random()*ind.length)];
    [ind[i], ind[j]] = [ind[j], ind[i]];
  }
  return ind;
}


// ======== –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª –≥–µ–Ω–µ—Ç–∏—á–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É ========
//–≥–µ–Ω–µ—Ç–∏—á–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —à—É–∫–∞—î –Ω–∞–π–∫—Ä–∞—â—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—é –∫–≤–∞—Ä—Ç–∏—Ä, —â–æ–± —É—Å—ñ–º –±—É–ª–æ —è–∫–Ω–∞–π–∑—Ä—É—á–Ω—ñ—à–µ
function runGA() {
  // –Ø–∫—â–æ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ ‚Äî –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
  if(apartments.length===0 || tenants.length===0){
    alert("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –æ–±–∏–¥–≤–∞ CSV —Ñ–∞–π–ª–∏!");
    return;
  }

  // 1Ô∏è‚É£ –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É –ø–æ–ø—É–ª—è—Ü—ñ—é –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —Ä—ñ—à–µ–Ω—å
  let population = Array.from({length: POP_SIZE}, createIndividual);

  // 2Ô∏è‚É£ –ü–æ–≤—Ç–æ—Ä—é—î–º–æ "–µ–≤–æ–ª—é—Ü—ñ—é" –±–∞–≥–∞—Ç–æ —Ä–∞–∑—ñ–≤
  for(let gen=0; gen<GENERATIONS; gen++){
    // –°–æ—Ä—Ç—É—î–º–æ —Ä—ñ—à–µ–Ω–Ω—è –∑–∞ —è–∫—ñ—Å—Ç—é
    population.sort((a,b)=> fitness(b)-fitness(a));

    // –ë–µ—Ä–µ–º–æ –∫—ñ–ª—å–∫–∞ –Ω–∞–π–∫—Ä–∞—â–∏—Ö (–µ–ª—ñ—Ç–Ω–∏—Ö)
    let nextPop = population.slice(0,ELITE);

    // –°—Ç–≤–æ—Ä—é—î–º–æ —Ä–µ—à—Ç—É —á–µ—Ä–µ–∑ —Å—Ö—Ä–µ—â—É–≤–∞–Ω–Ω—è —ñ –º—É—Ç–∞—Ü—ñ—é
    while(nextPop.length < POP_SIZE){
      let p1 = tournamentSelection(population);
      let p2 = tournamentSelection(population);
      let child = crossover(p1,p2);
      child = mutate(child);
      nextPop.push(child);
    }

    // –ù–æ–≤–µ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è —Å—Ç–∞—î –ø–æ—Ç–æ—á–Ω–∏–º
    population = nextPop;
  }

  // 3Ô∏è‚É£ –ü—ñ—Å–ª—è –µ–≤–æ–ª—é—Ü—ñ—ó ‚Äî –≤–∏–±–∏—Ä–∞—î–º–æ –Ω–∞–π–∫—Ä–∞—â–µ —Ä—ñ—à–µ–Ω–Ω—è
  population.sort((a,b)=> fitness(b)-fitness(a));
  displayResult(population[0]); // –í–∏–≤–æ–¥–∏–º–æ –π–æ–≥–æ –≤ —Ç–∞–±–ª–∏—Ü—é
}


// ======== –í–∏–≤—ñ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –≤ —Ç–∞–±–ª–∏—Ü—é ========
function displayResult(best){
  const table = document.getElementById("resultTable");
  table.querySelectorAll("tr:not(:first-child)").forEach(r=>r.remove());

  // –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä–∞–Ω—Ç–∞ –ø–æ–∫–∞–∑—É—î–º–æ –π–æ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä—É —ñ —Ä—ñ–≤–µ–Ω—å –∑–∞–¥–æ–≤–æ–ª–µ–Ω–æ—Å—Ç—ñ
  best.forEach((aptIdx, tenantIdx)=>{
    const t = tenants[tenantIdx];
    const a = apartments[aptIdx];

    // –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î–º–æ –∑–∞–¥–æ–≤–æ–ª–µ–Ω—ñ—Å—Ç—å
    const s_price = Math.max(0, Math.min(1, 1 - Math.abs(a.price - t.maxPrice)/t.maxPrice));
    const s_area  = Math.max(0, Math.min(1, a.area / t.minArea));
    const s_dist  = Math.max(0, Math.min(1, 1 - a.distance / t.maxDistance));
    const s_comf  = Math.max(0, Math.min(1, a.comfort / t.minComfort));

    const satValue = 0.3*s_price + 0.2*s_area + 0.2*s_dist + 0.3*s_comf;
    const satDisplay = satValue.toFixed(2); // –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—è –¥–æ —Å–æ—Ç–∏—Ö

    // –î–æ–¥–∞—î–º–æ —Ä—è–¥–æ–∫ —É —Ç–∞–±–ª–∏—Ü—é
    const row = document.createElement("tr");
    row.innerHTML = `<td>${tenantIdx+1}</td><td>${aptIdx+1}</td><td>${satDisplay}</td>`;

    // –ö–æ–ª—ñ—Ä –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä—ñ–≤–Ω—è –∑–∞–¥–æ–≤–æ–ª–µ–Ω–æ—Å—Ç—ñ
    if(satValue > 0.9) row.classList.add("high");     // –ó–µ–ª–µ–Ω–∏–π ‚Äî –≤–∏—Å–æ–∫–∞
    else if(satValue > 0.75) row.classList.add("medium"); // –ñ–æ–≤—Ç–∏–π ‚Äî —Å–µ—Ä–µ–¥–Ω—è
    else row.classList.add("low");                    // –ß–µ—Ä–≤–æ–Ω–∏–π ‚Äî –Ω–∏–∑—å–∫–∞

    table.appendChild(row);
  });
}

// ======== –ó–∞–ø—É—Å–∫ –∞–ª–≥–æ—Ä–∏—Ç–º—É –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –∫–Ω–æ–ø–∫–∏ ========
document.getElementById("runBtn").addEventListener("click", runGA);